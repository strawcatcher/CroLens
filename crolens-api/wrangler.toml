name = "crolens-api"
main = "build/worker/shim.mjs"
compatibility_date = "2024-01-01"

[build]
command = "cargo install -q worker-build && worker-build --release"
watch_dir = ["src"]

[vars]
CRONOS_CHAIN_ID = "25"
MULTICALL3_ADDRESS = "0xcA11bde05977b3631167028862bE2a173976CA11"
RPC_MAX_RETRIES = "3"
RATE_LIMIT_JSONRPC_PER_MIN = "120"
RATE_LIMIT_JSONRPC_WINDOW_SECS = "60"

# Sensitive vars are set via `wrangler secret put` or Cloudflare dashboard.
# Do NOT declare them here to avoid conflicts with secrets.
# Required secrets: BLOCKPI_RPC_URL
# Optional secrets: TENDERLY_API_KEY, TENDERLY_ACCESS_KEY, TENDERLY_ACCOUNT, TENDERLY_PROJECT, X402_PAYMENT_ADDRESS
X402_TOPUP_CREDITS = "1000"

# Allow CORS from frontend (multiple origins supported with comma)
CORS_ALLOW_ORIGIN = "https://crolens-web.pages.dev,https://strawcatcher.com"

[triggers]
crons = ["*/5 * * * *"]

[[kv_namespaces]]
binding = "KV"
id = "827c10be6ddf413f844d3fc445a9df6e"

[[d1_databases]]
binding = "DB"
database_name = "crolens-db"
database_id = "1018a32d-0ad4-4181-9df5-1ea86f86098a"
