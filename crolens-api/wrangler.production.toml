name = "crolens-api"
main = "build/worker/shim.mjs"
compatibility_date = "2024-01-01"

[build]
command = "cargo install -q worker-build && worker-build --release"
watch_dir = ["src"]

[vars]
CRONOS_CHAIN_ID = "25"
MULTICALL3_ADDRESS = "0xcA11bde05977b3631167028862bE2a173976CA11"

RPC_MAX_RETRIES = "3"
RPC_TIMEOUT_MS = "10000"
RPC_CACHE_TTL_SECS = "300"

# Sample 10% of successful tool calls (errors always logged).
REQUEST_LOG_SAMPLE_RATE = "0.1"

# JSON-RPC rate limit (per IP).
RATE_LIMIT_JSONRPC_PER_MIN = "120"
RATE_LIMIT_JSONRPC_WINDOW_SECS = "60"

# Production must set an explicit allowlist (comma-separated).
CORS_ALLOW_ORIGIN = "https://crolens-web.pages.dev,https://crolens.app"

# x402 payment config (public values).
X402_TOPUP_CREDITS = "1000"

[triggers]
# Run every minute to support 1/2/4 minute retry backoff.
crons = ["* * * * *"]

[[kv_namespaces]]
binding = "KV"
id = "827c10be6ddf413f844d3fc445a9df6e"

[[d1_databases]]
binding = "DB"
database_name = "crolens-db"
database_id = "1018a32d-0ad4-4181-9df5-1ea86f86098a"
